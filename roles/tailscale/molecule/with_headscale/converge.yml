---
- name: Converge
  hosts: tailscale

  environment:
    http_proxy: "{{ lookup('ansible.builtin.env', 'http_proxy') | default(omit) }}"
    https_proxy: "{{ lookup('ansible.builtin.env', 'https_proxy') | default(omit) }}"

  tasks:
    - name: "Include tailscale"
      ansible.builtin.include_role:
        name: "tailscale"
      vars:
        tailscale_login_server: hostvars['headscale']['ansible_default_ipv4']['address']
